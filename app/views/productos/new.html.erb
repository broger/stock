<div id="titulo" style="padding: 10px 0 6px 20px ">
    <h3 >Nuevo Producto</h3>
</div>
<% form_for(@producto) do |f| %>
  <%= f.error_messages %>
<div class="well" style="background-color:white">
	<div class="brogertab" >
	            <ul id="myTab" class="nav nav-tabs">
	              <li class="active"><a href="#general"    data-toggle="tab">Generales</a></li>
	              <li class=""><a href="#categoria"  data-toggle="tab">Categoria</a></li>
	              <li class=""><a href="#precios"        data-toggle="tab">Precios</a></li>
                <li class=""><a href="#descripcion"        data-toggle="tab">Descripci&oacute;</a></li>
                <li class=""><a href="#web"        data-toggle="tab">Web</a></li>
	            </ul>

				 <div id="myTabContent" class="tab-content" style="padding:10px 0px 0px 30px">
	    					<div  class="tab-pane active"  id="general" >
                             <table >
                                 <tr>
                                      <td style="height:20px">
                                        <div class="form-group">
                                         <% ultimo =  Producto.count >= 1  ? "#{Producto.last.id.to_i + 1}" : "1"  %>
                                            <%= f.label :codigo, "c&oacute;digo"   %>
                                            <%= f.text_field :codigo, :value=> ultimo, :size=>20, :style=>'margin-right:60px; width:120px; display:inline', :class=>'form-control' %>
                                          	<%= f.label :nombre, "nombre" %><%= f.text_field :nombre , :size=>60, :class=>'form-control', :style=>'margin-right:60px; width:380px; display:inline' %> 
                                        </div>
                                       </td>
                                 </tr>
                                 <tr>
                                       <td >
                                         <%= f.label :unidad_id, "unidad medida" %><%= f.select(:unidad_id, Unidad.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px; height:24px' } ) %>
                                         <%= f.label :estado_id, "estado" %><%= f.select(:estado_id, Estado.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px; height:24px' } ) %>
                                         <%= f.label :etiqueta_busqueda,  "etiqueta b&uacute;squeda" %><%= f.text_field :etiqueta_busqueda  , :size=>60 %> 
                             		   </td>
                                  </tr>
                                  <tr>
                                     <td> <%= f.label :stock_minimo, "stock M&iacute;nimo" , :size=>10 %> 
                                           <%= f.text_field :stock_minimo,:size=>16,:placeholder => ' 0.00' , :size=>10, :style=>"margin-right:30px" %> 
                                           <%= f.label :stock_maximo, "stock M&aacute;ximo" %>
                                           <%= f.text_field :stock_maximo,:size=>16,:placeholder => ' 0.00' , :size=>10, :style=>"margin-right:30px" %> 
                                           <%= f.label :punto_de_pedido, "avisa en" %>
                                           <%= f.text_field :punto_de_pedido,:size=>16,:placeholder => ' 0.00' , :size=> 10 %> 
                                       </td>
                                  </tr>
                               </table>
                               	
		                    </div>
		                     <div class="tab-pane fade" id="categoria">
                        <table style="width:360px; display:inline; float: left">
                                                <tr>
                                                     <th><%= f.label :rubro_id, "Rubro" %></th>
                                                     <td><% unless Rubro.count == 0 %>
                                                            <%=  Rubro.count > 1 ? "#{f.select :rubro_id, Rubro.find(:all).collect{|t|[t.nombre, t.id]}, {:include_blank => true}}" : "#{Rubro.first.nombre}" %>
                                                        <% end %>
                                                     </td>
                                                </tr>
                                                <tr>
                                                     <th><%= f.label :seccion_id, "Secci&oacute;n" %></th>
                                                     <td><%=  f.select :seccion_id, Seccion.find(:all).collect{|t|[t.nombre, t.id]}, {:include_blank => true}%></td>
                                                </tr>
                                                 <tr>
                                                     <th><%= f.label :categoria_id, "Categoria" %></th>
                                                     <td><%=  f.select :categoria_id, Categoria.find(:all).collect{|t|[t.nombre, t.id]}, {:include_blank => true}%></td>
                                                </tr>
                                            </table>
                                            <table style="width:350px; display:inline; float: left">
                                                <tr>
                                                       <th><%= f.label :codigo_proveedor, "C&oacute;digo Proveedor" %></th>
                                                       <td><%= f.text_field :codigo_proveedor %></td>
                                                  </tr>
                                                  <tr>
                                                       <th><%= f.label :proveedor_id, "Proveedor" %></th>
                                                       <td><%= f.select :proveedor_id, Proveedor.find(:all).collect{|t|[t.razon_social, t.id]}, {:include_blank => true} %></td>
                                                  </tr>
                                                    <tr>
                                                       <th><%= f.label :marca_id, "Marca" %></th>
                                                       <td><%= f.select :marca_id, Marca.find(:all).collect{|t|[t.nombre, t.id]}, {:include_blank => true} %></td>
                                                  </tr>
                                                  
                                             </table>
                                             <table>
                                                    <tr>
                                                        <td>
                                                              
                                                            <%= f.label 'calificacion_a','A'%>                               
                                                            <%= f.radio_button :calificacion, 'A', :checked => true %> 
                                                        </td>
                                                  </tr>
                                                  <tr>
                                                        <td>
                                                            <%= f.label 'calificacion_b','B'%>
                                                            <%= f.radio_button :calificacion, 'B', :checked => false %>
                                                            
                                                        </td>

                                                  </tr>
                                                  <tr>
                                                        <td>
                                                            <%= f.label 'calificacion_c','C'%>
                                                            <%= f.radio_button :calificacion, 'C', :checked => false %>
                                                            
                                                        </td>
                                                        
                                                  </tr>

                                                </table>

                      </div>
                      <div class="tab-pane fade" id="precios">
                                           <table>
                                                <tr>
                                                    <th>Lista</th>
                                                    <th>Precio</th>
                                                    <th>Descuento</th>
                                                </tr>
                                                <% ListaPrecio.all.each  do |lista| %>
                                                      <tr>
                                                        <td><%= lista.nombre %></td>
                                                        <td></td>
                                                        <td></td>
                                                      </tr>
                                                <% end %>      
                                            </table>
                      </div>
                      <div class="tab-pane fade" id="web">
                                             <table>
                                                  <tr>
                                                    <td> <div style="vertical-align: middle"><%= "#{f.check_box :visible_web} Visible para la Web" %></div></td>
                                                    <td></td>
                                                  </tr>
                                              </table>
                      </div>
              
              
                      <div class="tab-pane fade" id="descripcion">
                        <table style="width:100%">
                                <tr>
                                  <td><%= f.text_area :descripcion , :cols => "50", :rows => "10" ,:placeholder => 'describa el producto aqui ...'%></td>
                                </tr>
                        </table>
                                            
                      </div>	




	            </div>

	</div>

</div>
<div id="pie" style="height:30px; padding:16px">
 <div style="text-align: right"><p> <%= f.submit 'Guardar', :class=>"btn btn-danger" %></p></div>
</div>
<% end %>


<script type="text/javascript">

    $(document).ready(function(){
            $("#new_producto").validate({
             rules: {
                  "producto[nombre]": {required: true, rangelength: [3,60]},
                  "producto[marca_id]": {required: true},
                  "producto[unidad_id]": {required: true},
                  "producto[rubro_id]": {required: true},
                  "producto[seccion_id]": {required: true},
                  "producto[categoria_id]": {required: true},
                  "producto[proveedor_id]": {required: true},
                  "producto[moneda_id]": {required: true},
                  "producto[estado_id]": {required: true},
                  "producto[deposito_id]": {required: true},
                  "producto[proveedor_id]": {required: true},
                  "producto[codigo_proveedor]": {digits: true},
                  "producto[codigo_proveedor]": {digits: true}

                  }
            });

            seccionSelec();
            categoriaSelec();
            marcasSelec();
            
    });

    $.validator.addMethod('Decimal', function(value, element) {
    return this.optional(element) || /^[0-9,]+(\.\d{0,3})?$/.test(value);
    }, "formato correcto 0000.00");

     $('#myTab a').click(function (e) {
          e.preventDefault();
          $(this).tab('show');
        });


    var secciones = new Array();
    <% secciones = Seccion.find(:all) %>
    <% for seccion in secciones -%>
          secciones.push(new Array(<%= seccion.rubro_id %>, "<%=h seccion.nombre %>", <%= seccion.id %>));
    <% end %>
    $('#producto_rubro_id').change(seccionSelec);
    $('#producto_rubro_id').change(marcasSelec);
    

    var categorias = new Array();
    <% categorias = Categoria.find(:all) %>
    <% for categoria in categorias -%>
          categorias.push(new Array(<%=h categoria.seccion_id %>, "<%=h categoria.nombre %>", <%=h categoria.id %>));
    <% end %>
    $('#producto_seccion_id').change(categoriaSelec);

    var marcas = new Array();
    <% marcas = Marca.find(:all) %>
    <% for marca in marcas -%>
          marcas.push(new Array(<%=h marca.rubro_id %>, "<%=h marca.nombre %>", <%=h marca.id %>));
    <% end %>


    
    function seccionSelec() {
        rubro_id = $('#producto_rubro_id').val();
        $('#producto_seccion_id').empty();
        $('#producto_categoria_id').empty();
        $('#producto_seccion_id').append(selec='<option></option>');
        secciones.forEach(function(seccion){
            if (seccion[0]==rubro_id){
              $('#producto_seccion_id').append(selec='<option value="'+ seccion[2] +'">'+seccion[1]+'</option>');
            }
        });
    }

    function categoriaSelec() {
        seccion_id = $('#producto_seccion_id').val();
        $('#producto_categoria_id').empty();
        $('#producto_categoria_id').append(selec='<option></option>');
        categorias.forEach(function(categoria){
            if (categoria[0]==seccion_id){
                $('#producto_categoria_id').append(selec='<option value="'+ categoria[2] +'">'+categoria[1]+'</option>');
            }
        });
    }

    function marcasSelec() {
        rubro_id = $('#producto_rubro_id').val();
        $('#producto_marca_id').empty();
        $('#producto_marca_id').append(selec='<option></option>');
        marcas.forEach(function(marca){
            if (marca[0]==rubro_id){
                $('#producto_marca_id').append(selec='<option value="'+ marca[2] +'">'+ marca[1]+'</option>');
            }
        });
    }
   
     /* $('#producto_costo').keypress(totales_precio);
           $('#producto_costo').change(totales_precio);
           $('#producto_ganancia').keypress(totales_precio);
           $('#producto_descuento').keypress(totales_precio);
           $('#producto_iva').keypress(totales_precio);
           $('#producto_iva').change(totales_precio);

           function totales_precio(){

            var costo =  $('#producto_costo').val();
            var text_ganancia = $('#producto_ganancia').val();
            var text_iva = $('#producto_iva').val();
            var text_descuento =  $('#producto_descuento').val();

            var costo = parseInt(costo);
            
            if (text_ganancia == null || text_ganancia == 0){
                 ganancia = 0;
                 }
            else {
                var text_ganancia = parseInt(text_ganancia);
                ganancia = text_ganancia * costo / 100;
            };

            if (text_iva == null || text_iva == 0){
                 iva = 0;
                 }
            else {
                var text_iva = parseInt(text_iva);
                iva = text_iva * costo / 100;
            };

            if (text_descuento == null || text_descuento == 0){
                 descuento = 0;
                 }
            else {
                var text_descuento = parseInt(text_descuento);
                descuento = text_descuento * costo / 100;
            };


            precio_lista = costo + ganancia + iva ;
            precio_contado = precio_lista - descuento;
            
            $('#total_ganancia').text(ganancia);
            $('#total_iva').text(iva);
            $('#total_desc_contado').text(descuento);
            $('#precio_contado').text(precio_contado);
            $('#precio_lista').text(precio_lista); 
          } */ 

</script>



<style type="text/css">

  .form-control{
     border-radius: 1px;
    font-size: 12px;
    display: inline;
  }

  select{
    padding: 2px;
  }
  

  input{
    padding-left: 4px
  }

  #fancybox-outer{
    background-color: #f5f5f5;
  }

  label{
    margin-right: 6px

  }

  table tr {
    height: 52px
  }
	
	#fancybox-wrap {
	  padding:0;
	}

	#fancybox-inner {
	position:relative;
	}

.brogertab{
          min-height: 260px;
          height: auto;
    }

    .tab-content{
        background-color: white
    }

</style>

