<div id="titulo" style="padding: 10px 0 6px 20px ">
    <h3 >Nuevo Producto</h3>
</div>
<% form_for(@producto) do |f| %>
  <%= f.error_messages %>
<div class="well" style="background-color:white">
	<div class="brogertab" >
	            <ul id="myTab" class="nav nav-tabs">
	              <li class="active"><a href="#general"    data-toggle="tab">Generales</a></li>
	              <li class=""><a href="#categoria"  data-toggle="tab">Categoria</a></li>
	              <li class=""><a href="#precios"        data-toggle="tab">Precios</a></li>
                <li class=""><a href="#descripcion"        data-toggle="tab">Descripci&oacute;n</a></li>
                <li class=""><a href="#web"        data-toggle="tab">Web</a></li>
	            </ul>

				 <div id="myTabContent" class="tab-content" style="padding:20px">
	    					<div  class="tab-pane active"  id="general" >
                         <% ultimo =  Producto.count >= 1  ? "#{Producto.last.id.to_i + 1}" : "1"  %>
                            <div class= "datos" ><%= f.label :codigo, "c&oacute;digo"%><%= f.text_field :codigo,  :value=> ultimo, :style=>'width:120px', :class=>'form-control'  %></div>
                            <div class= "datos" style="margin-left:20px"><%= f.label :nombre    %><%= f.text_field :nombre , :style=>'width:300px', :class=>'form-control' %></div>
                            <div class= "datos" style="margin-left:20px"><%= f.label :estado_id %><%= f.select(:estado_id, Estado.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } ) %></div>               
                            <div class= "datos" ><%= f.label :unidad_id, "unidad medida" %><%= f.select(:unidad_id, Unidad.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } )%></div>
                            <div class= "datos" style="margin-left:20px">
                              <%= f.label :stock_minimo, "stock m&iacute;nimo"%><%= f.text_field :stock_minimo, :placeholder => '0.00', :style=>'width:80px', :class=>'form-control' %>
                              <%= f.label :stock_ideal, "stock ideal"%><%= f.text_field :stock_ideal, :placeholder => '0.00', :style=>'width:80px', :class=>'form-control' %> 
                              <%= f.label :stock_minimo, "avisa en"%><%= f.text_field :punto_de_pedido, :placeholder => '0.00', :style=>'width:80px', :class=>'form-control' %> 
                            </div> 

                       <!--     
                           
                         <div class= "datos" style="width:20px"><%= f.label :etiqueta_busqueda,  "etiqueta b&uacute;squeda" %><%= f.text_field :etiqueta_busqueda, :size=>60 %></div>  
                            
                            <div class= "datos" style="width:200px"><%= f.text_field :punto_de_pedido,:size=>16,:placeholder => ' 0.00' , :size=> 10 %> </div>        
                        -->
                </div>
                <div class="tab-pane fade" id="stock">

                </div>
                <div class="tab-pane fade" id="categoria">
                        <table style="width:100%; display:inline; float: left">
                             <tr>
                                 <th><%= f.label :rubro_id, "Rubro" %></th>
                                 <td>
                                  <% unless Rubro.count == 0 %>
                                  <%=  Rubro.count > 1 ? "#{f.select(:rubro_id, Rubro.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } )}" : "#{Rubro.first.nombre}" %>
                                  <% end %>
                                 </td>
                                 <!-- COLUMNA 2 -->
                                 <th><%= f.label :proveedor_id, "Proveedor" %></th>
                                 <td><%=  f.select(:proveedor_id, Proveedor.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } ) %></td>
                                 <!-- COLUMNA 3 -->
                                 <th><%= f.label :calificacion_id, "Calificaci&oacute;n" %></th>
                                 <td>
                                      <div class= "datos" style="width:160px" >
                                          <div class="btn-group" data-toggle="buttons">
                                            <label class="btn btn-primary active" style="padding:5px; margin-right:0px">
                                              <input type="radio" name="options" value="A" id="option1">A</label>
                                            <label class="btn btn-primary" style="padding:5px; margin-right:0px">
                                              <input type="radio" name="options" value="B" id="option2">B</label>
                                            <label class="btn btn-primary" style="padding:5px; margin-right:0px">
                                              <input type="radio" name="options" value="C" id="option3" style="border-radius:1px">C</label>
                                          </div>
                                        <%= hidden_field_tag :calificacion, 'A' %>  
                                      </div>
                                  </td> 
                             </tr>
                             <tr>  
                                 <th><%= f.label :seccion_id, "Secci&oacute;n" %></th>
                                 <td><%=  f.select(:seccion_id, Seccion.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } ) %></td>
                                 <!-- COLUMNA 2 -->
                                 <th></th>
                                 <td></td>  
                             </tr>
                             <tr>
                                 <th><%= f.label :categoria_id, "Categoria" %></th>
                                 <td><%= f.select(:categoria_id, Categoria.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } )%></td>
                                 <!-- COLUMNA 2 -->
                                 <th></th>
                                 <td></td> 
                             </tr>
                             <tr>
                                 <th><%= f.label :marca_id, "Marca" %></th>
                                 <td><%= f.select(:marca_id, Marca.find(:all).collect{|t|[t.nombre, t.id]}, {:selected=>1}, {:class => "form-control", :style => 'width:120px' } )%></td>
                                 <!-- COLUMNA 2 -->
                                 <th></th>
                                 <td></td> 
                             </tr>
                        </table>
                </div>
                <div class="tab-pane fade" id="precios">
                                    <div class="scroll" style="margin:10px 10px">
                                           <table>
                                                <thead>
                                                <tr style="background-color:#c6c6c6; color:#5A5A5A; font-size:12px; text-align:left; height:28px">
                                                    <th style= "width:50%; text-align:left; padding-left:6px">Lista</th>
                                                    <th style= "width:25%; text-align:left">Precio</th>
                                                    <th style= "width:25%; text-align:left">Descuento</th>
                                                </tr>
                                                </thead>
                                                <tbody style="background-color:#e5e5e5; padding-top:4px">
                                                <% ListaPrecio.all.each  do |lista| %>
                                                      <tr >
                                                        <td style= "width:50%; text-align:left; padding-left:6px"><%= lista.nombre %></td>
                                                        <td width="25%"><input id='precio_<%= lista.id %>' name= 'lista_precio[<%=lista.id %>][precio]' class='form-control input-sm'  style='width:80px; height:25px' ></input></td>
                                                        <td width="25%"><input id='desc_<%= lista.id %>'   name= 'lista_precio[<%=lista.id %>][desc]'   class='form-control input-sm'  style='width:80px; height:25px' ></input></td>
                                                      </tr>
                                                <% end %>
                                                </tbody>
                                            </table>
                                     </div>       
                      </div>
                      <div class="tab-pane fade" id="web">
                                             <table>
                                                  <tr>
                                                    <td> <div style="vertical-align: middle"><%= "#{f.check_box :visible_web} Visible para la Web" %></div></td>
                                                    <td></td>
                                                  </tr>
                                              </table>
                      </div>
              
              
                      <div class="tab-pane fade" id="descripcion">
                        <table style="width:100%">
                                <tr>
                                  <td><%= f.text_area :descripcion , :cols => "50", :rows => "10" ,:placeholder => 'describa el producto aqui ...', :style=>'' %></td>
                                </tr>
                        </table>
                                            
                      </div>	

	            </div>

	</div>

</div>
<div id="pie" style="height:30px; padding:16px">
 <div style="text-align: right"><p> <%= f.submit 'Guardar', :class=>"btn btn-danger" %></p></div>
</div>
<% end %>


<script type="text/javascript">

    $(document).ready(function(){
            $("#new_producto").validate({
             rules: {
                  "producto[nombre]": {required: true, rangelength: [3,60]},
                  "producto[marca_id]": {required: true},
                  "producto[unidad_id]": {required: true},
                  "producto[rubro_id]": {required: true},
                  "producto[seccion_id]": {required: true},
                  "producto[categoria_id]": {required: true},
                  "producto[proveedor_id]": {required: true},
                  "producto[moneda_id]": {required: true},
                  "producto[estado_id]": {required: true},
                  "producto[deposito_id]": {required: true},
                  "producto[proveedor_id]": {required: true},
                  "producto[codigo_proveedor]": {digits: true},
                  "producto[codigo_proveedor]": {digits: true}

                  }
            });

            seccionSelec();
            categoriaSelec();
            marcasSelec();        

            
    });

    <% ListaPrecio.all.each  do |lista| %>
        $('#precio_<%= lista.id %>').val('0.00');
        $('#precio_<%= lista.id %>').addClass('required');
        $('#precio_<%= lista.id %>').addClass('number');
        $('#desc_<%= lista.id %>').val('0.00');
        $('#desc_<%= lista.id %>').addClass('required');
        $('#desc_<%= lista.id %>').addClass('number');
    <% end %>  

    $.validator.addMethod('Decimal', function(value, element) {
    return this.optional(element) || /^[0-9,]+(\.\d{0,3})?$/.test(value);
    }, "formato correcto 0000.00");

     $('#myTab a').click(function (e) {
          e.preventDefault();
          $(this).tab('show');
        });


    var secciones = new Array();
    <% secciones = Seccion.find(:all) %>
    <% for seccion in secciones -%>
          secciones.push(new Array(<%= seccion.rubro_id %>, "<%=h seccion.nombre %>", <%= seccion.id %>));
    <% end %>
    $('#producto_rubro_id').change(seccionSelec);
    $('#producto_rubro_id').change(marcasSelec);
    

    var categorias = new Array();
    <% categorias = Categoria.find(:all) %>
    <% for categoria in categorias -%>
          categorias.push(new Array(<%=h categoria.seccion_id %>, "<%=h categoria.nombre %>", <%=h categoria.id %>));
    <% end %>
    $('#producto_seccion_id').change(categoriaSelec);

    var marcas = new Array();
    <% marcas = Marca.find(:all) %>
    <% for marca in marcas -%>
          marcas.push(new Array(<%=h marca.rubro_id %>, "<%=h marca.nombre %>", <%=h marca.id %>));
    <% end %>


    
    function seccionSelec() {
        rubro_id = $('#producto_rubro_id').val();
        $('#producto_seccion_id').empty();
        $('#producto_categoria_id').empty();
        $('#producto_seccion_id').append(selec='<option></option>');
        secciones.forEach(function(seccion){
            if (seccion[0]==rubro_id){
              $('#producto_seccion_id').append(selec='<option value="'+ seccion[2] +'">'+seccion[1]+'</option>');
            }
        });
    }

    function categoriaSelec() {
        seccion_id = $('#producto_seccion_id').val();
        $('#producto_categoria_id').empty();
        $('#producto_categoria_id').append(selec='<option></option>');
        categorias.forEach(function(categoria){
            if (categoria[0]==seccion_id){
                $('#producto_categoria_id').append(selec='<option value="'+ categoria[2] +'">'+categoria[1]+'</option>');
            }
        });
    }

    function marcasSelec() {
        rubro_id = $('#producto_rubro_id').val();
        $('#producto_marca_id').empty();
        $('#producto_marca_id').append(selec='<option></option>');
        marcas.forEach(function(marca){
            if (marca[0]==rubro_id){
                $('#producto_marca_id').append(selec='<option value="'+ marca[2] +'">'+ marca[1]+'</option>');
            }
        });
    }
   
     /* $('#producto_costo').keypress(totales_precio);
           $('#producto_costo').change(totales_precio);
           $('#producto_ganancia').keypress(totales_precio);
           $('#producto_descuento').keypress(totales_precio);
           $('#producto_iva').keypress(totales_precio);
           $('#producto_iva').change(totales_precio);

           function totales_precio(){

            var costo =  $('#producto_costo').val();
            var text_ganancia = $('#producto_ganancia').val();
            var text_iva = $('#producto_iva').val();
            var text_descuento =  $('#producto_descuento').val();

            var costo = parseInt(costo);
            
            if (text_ganancia == null || text_ganancia == 0){
                 ganancia = 0;
                 }
            else {
                var text_ganancia = parseInt(text_ganancia);
                ganancia = text_ganancia * costo / 100;
            };

            if (text_iva == null || text_iva == 0){
                 iva = 0;
                 }
            else {
                var text_iva = parseInt(text_iva);
                iva = text_iva * costo / 100;
            };

            if (text_descuento == null || text_descuento == 0){
                 descuento = 0;
                 }
            else {
                var text_descuento = parseInt(text_descuento);
                descuento = text_descuento * costo / 100;
            };


            precio_lista = costo + ganancia + iva ;
            precio_contado = precio_lista - descuento;
            
            $('#total_ganancia').text(ganancia);
            $('#total_iva').text(iva);
            $('#total_desc_contado').text(descuento);
            $('#precio_contado').text(precio_contado);
            $('#precio_lista').text(precio_lista); 
          } */ 

</script>



<style type="text/css">



  table td{
      height: 40px;
    }

  table th{
    text-align: right;
    width: 80px;
  }

  table td{
    text-align: left ;
    width: 180px;
  }

  table label{
      font-size: 11px;
    }

  select{
    padding: 2px;
  }
  

  input{
    padding-left: 4px
  }

  #fancybox-outer{
    background-color: #f5f5f5;
  }

  label{
    margin-right: 6px

  }

	
	#fancybox-wrap {
	  padding:0;
	}

	#fancybox-inner {
	position:relative;
	}

  .brogertab{
          min-height: 260px;
          height: auto;
    }

    .tab-content{
        background-color: white
    }


    .datos{
          display: inline;
          text-align: left;
      }


        .datos label{
          padding: 0 6px;
          font-size: 12px;
          padding-bottom: 20px 
        }

        .datos input{
          display: inline;
          font-size: 11px 
        }

        .datos select{
          display: inline;
          font-size: 12px;
          height:28px 
        }

        textarea{
          font-size: 14px
        }

    
    .tabla_detalle{
       background-color:white;
       font-size:11px;
       width:100%;
       display:block
    }

</style>

